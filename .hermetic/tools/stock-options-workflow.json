{
  "name": "Stock Options Playbook Generator",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "35 9 * * 1-5"
            }
          ]
        }
      },
      "id": "daily-scan-trigger",
      "name": "Daily Market Scan (9:35 AM ET)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "// List of high-liquidity tickers to scan\nconst tickers = [\n  'SPY', 'QQQ', 'IWM',  // ETFs\n  'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA',  // Mega caps\n  'NVDA', 'AMD', 'META', 'NFLX',  // Tech\n  'JPM', 'BAC', 'GS',  // Finance\n  'XLE', 'XLF', 'XLK'  // Sector ETFs\n];\n\nreturn tickers.map(ticker => ({\n  json: {\n    ticker: ticker,\n    scanTime: new Date().toISOString()\n  }\n}));"
      },
      "id": "ticker-list",
      "name": "Generate Ticker List",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "=https://query1.finance.yahoo.com/v8/finance/chart/{{ $json.ticker }}?interval=1d&range=3mo",
        "options": {
          "timeout": 10000
        }
      },
      "id": "fetch-stock-data",
      "name": "Fetch Stock Data",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "jsCode": "// Parse Yahoo Finance response and calculate technical indicators\nconst data = $input.item.json;\nconst ticker = $('Generate Ticker List').item.json.ticker;\n\nif (!data.chart || !data.chart.result || !data.chart.result[0]) {\n  return { json: { skip: true } };\n}\n\nconst result = data.chart.result[0];\nconst quotes = result.indicators.quote[0];\nconst timestamps = result.timestamp;\n\n// Get last 20 closes for RSI\nconst closes = quotes.close.slice(-20);\nconst currentPrice = closes[closes.length - 1];\n\n// Simple RSI calculation (14-period)\nfunction calculateRSI(prices, period = 14) {\n  if (prices.length < period + 1) return 50;\n  \n  let gains = 0;\n  let losses = 0;\n  \n  for (let i = prices.length - period; i < prices.length; i++) {\n    const change = prices[i] - prices[i - 1];\n    if (change > 0) gains += change;\n    else losses -= change;\n  }\n  \n  const avgGain = gains / period;\n  const avgLoss = losses / period;\n  const rs = avgGain / avgLoss;\n  return 100 - (100 / (1 + rs));\n}\n\n// Calculate 50-day SMA\nfunction calculateSMA(prices, period) {\n  const slice = prices.slice(-period);\n  return slice.reduce((a, b) => a + b, 0) / slice.length;\n}\n\nconst rsi = calculateRSI(closes);\nconst sma50 = calculateSMA(closes, Math.min(50, closes.length));\nconst volume = quotes.volume[quotes.volume.length - 1];\nconst avgVolume = quotes.volume.slice(-20).reduce((a, b) => a + b, 0) / 20;\n\n// Determine if this is a good opportunity\nconst isBullish = rsi < 35 && currentPrice > sma50;\nconst isBearish = rsi > 65 && currentPrice < sma50;\nconst isHighVolume = volume > avgVolume * 1.5;\n\nreturn {\n  json: {\n    ticker: ticker,\n    currentPrice: currentPrice.toFixed(2),\n    rsi: rsi.toFixed(2),\n    sma50: sma50.toFixed(2),\n    volume: volume,\n    avgVolume: avgVolume,\n    volumeRatio: (volume / avgVolume).toFixed(2),\n    signal: isBullish ? 'BULLISH' : (isBearish ? 'BEARISH' : 'NEUTRAL'),\n    isOpportunity: (isBullish || isBearish) && isHighVolume,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "analyze-technicals",
      "name": "Analyze Technicals",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.isOpportunity }}",
              "value2": true
            }
          ]
        }
      },
      "id": "filter-opportunities",
      "name": "Filter Opportunities",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "jsCode": "// Generate playbook based on signal\nconst data = $input.item.json;\nconst ticker = data.ticker;\nconst price = parseFloat(data.currentPrice);\nconst signal = data.signal;\nconst rsi = parseFloat(data.rsi);\n\n// Determine strategy based on technical setup\nlet strategy, outlook, play, maxProfit, maxLoss, breakeven, reasoning;\n\nif (signal === 'BULLISH') {\n  strategy = 'Bull Call Spread';\n  outlook = 'Moderately Bullish';\n  \n  const lowerStrike = Math.floor(price);\n  const upperStrike = lowerStrike + 5;\n  const callDebit = 2.50;  // Estimated\n  const callCredit = 1.00;  // Estimated\n  const netDebit = callDebit - callCredit;\n  \n  play = `BUY:  1x $${ticker} ${lowerStrike} Call @ $${callDebit.toFixed(2)}\\nSELL: 1x $${ticker} ${upperStrike} Call @ $${callCredit.toFixed(2)}\\nNET DEBIT: $${netDebit.toFixed(2)} per spread`;\n  maxProfit = `$${((upperStrike - lowerStrike - netDebit) * 100).toFixed(0)} (${(((upperStrike - lowerStrike - netDebit) / netDebit) * 100).toFixed(0)}%)`;\n  maxLoss = `$${(netDebit * 100).toFixed(0)} (100%)`;\n  breakeven = `$${(lowerStrike + netDebit).toFixed(2)}`;\n  reasoning = `${ticker} is oversold with RSI at ${rsi}. Price bouncing off support. Bull call spread captures upside while limiting risk.`;\n  \n} else if (signal === 'BEARISH') {\n  strategy = 'Bear Put Spread';\n  outlook = 'Moderately Bearish';\n  \n  const upperStrike = Math.ceil(price);\n  const lowerStrike = upperStrike - 5;\n  const putDebit = 2.50;  // Estimated\n  const putCredit = 1.00;  // Estimated\n  const netDebit = putDebit - putCredit;\n  \n  play = `BUY:  1x $${ticker} ${upperStrike} Put @ $${putDebit.toFixed(2)}\\nSELL: 1x $${ticker} ${lowerStrike} Put @ $${putCredit.toFixed(2)}\\nNET DEBIT: $${netDebit.toFixed(2)} per spread`;\n  maxProfit = `$${((upperStrike - lowerStrike - netDebit) * 100).toFixed(0)} (${(((upperStrike - lowerStrike - netDebit) / netDebit) * 100).toFixed(0)}%)`;\n  maxLoss = `$${(netDebit * 100).toFixed(0)} (100%)`;\n  breakeven = `$${(upperStrike - netDebit).toFixed(2)}`;\n  reasoning = `${ticker} is overbought with RSI at ${rsi}. Price at resistance. Bear put spread profits from pullback while limiting risk.`;\n}\n\nconst timeframe = '30 days';\nconst probability = signal === 'BULLISH' ? '65%' : '60%';\n\nreturn {\n  json: {\n    ticker: ticker,\n    strategy: strategy,\n    outlook: outlook,\n    timeframe: timeframe,\n    play: play,\n    maxProfit: maxProfit,\n    maxLoss: maxLoss,\n    breakeven: breakeven,\n    probability: probability,\n    reasoning: reasoning,\n    currentPrice: data.currentPrice,\n    rsi: data.rsi,\n    volumeRatio: data.volumeRatio,\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "generate-playbook",
      "name": "Generate Playbook",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1250, 300]
    },
    {
      "parameters": {
        "jsCode": "// Format playbook for Telegram\nconst p = $input.item.json;\n\nconst message = `ğŸ¯ **PLAYBOOK: ${p.strategy}**\n\nğŸ“Š **TICKER:** $${p.ticker}\nğŸ’¡ **OUTLOOK:** ${p.outlook}\nâ° **TIMEFRAME:** ${p.timeframe}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“ˆ **THE PLAY**\n\n${p.play}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’° **PROFIT/LOSS**\n\nMAX PROFIT: ${p.maxProfit}\nMAX LOSS: ${p.maxLoss}\nBREAKEVEN: ${p.breakeven}\n\nPROBABILITY OF PROFIT: ${p.probability}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“ **WHY THIS WORKS**\n\n${p.reasoning}\n\nCurrent Price: $${p.currentPrice}\nRSI: ${p.rsi}\nVolume: ${p.volumeRatio}x average\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“‹ **ENTRY RULES**\n\nâœ… Confirm price action\nâœ… Check options liquidity\nâœ… Verify bid-ask spread <$0.10\nâŒ DO NOT enter blindly\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸšª **EXIT STRATEGIES**\n\nğŸ¯ TARGET 1: 50% profit\nğŸ¯ TARGET 2: 100% profit\nğŸ›‘ STOP LOSS: 50% loss\nâ° TIME EXIT: 7 days before expiry\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš ï¸ **RISK DISCLOSURE**\n\nOptions can expire worthless.\nMaximum loss is ${p.maxLoss}.\nThis is EDUCATION, not advice.\nPaper trade first!\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“š **LEARN MORE**\n\nStrategy: ${p.strategy}\nInvestopedia: https://investopedia.com\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâš–ï¸ Position sizing: Risk max 2% of account\nğŸ“Š Track results in spreadsheet\n`;\n\nreturn {\n  json: {\n    message: message,\n    ticker: p.ticker,\n    timestamp: p.timestamp\n  }\n};"
      },
      "id": "format-telegram",
      "name": "Format for Telegram",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1450, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot8005622076:AAGwEKcZHWokqyHY8c711D1Rs9r97dbEErs/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={ \"chat_id\": \"1540112442\", \"text\": \"{{ $json.message }}\", \"parse_mode\": \"Markdown\" }"
      },
      "id": "send-telegram",
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1650, 300]
    }
  ],
  "connections": {
    "Daily Market Scan (9:35 AM ET)": {
      "main": [[{ "node": "Generate Ticker List", "type": "main", "index": 0 }]]
    },
    "Generate Ticker List": {
      "main": [[{ "node": "Fetch Stock Data", "type": "main", "index": 0 }]]
    },
    "Fetch Stock Data": {
      "main": [[{ "node": "Analyze Technicals", "type": "main", "index": 0 }]]
    },
    "Analyze Technicals": {
      "main": [[{ "node": "Filter Opportunities", "type": "main", "index": 0 }]]
    },
    "Filter Opportunities": {
      "main": [[{ "node": "Generate Playbook", "type": "main", "index": 0 }]]
    },
    "Generate Playbook": {
      "main": [[{ "node": "Format for Telegram", "type": "main", "index": 0 }]]
    },
    "Format for Telegram": {
      "main": [[{ "node": "Send to Telegram", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  }
}
